{% extends "./layout/layout.html" %}

{% block title %}Sign in{% endblock %}

{% block body %}
  <h1 class="heading-large">Sign in</h1>

  <!--<p style="vertical-align:top">Don't have an account? <a class="button" style="margin-left:30px;line-height: inherit;vertical-align:middle;background-color: #333" href="create_account?title_number={{data.title_number}}" id="register-link">register to use this service</a></p>-->

  <div class="grid-row">
    <div class="column-two-thirds">

      <form id="been-here-before" method="GET" action="create_account">
        <h1 class="heading-medium spacing-top-flush">Do you already have an account?</h1>

        {% if data.title_number %}
          <input name="title_number" value="{{data.title_number}}" type="hidden" />
        {% endif %}

        <fieldset class="inline spacing-bottom-single">
          <legend class="visuallyhidden">Do you already have a user account?</legend>

          <label class="block-label" for="been-here-before-yes">
            <input id="been-here-before-yes" type="radio" name="been-here-before" value="Yes">
            Yes
          </label>
          <label class="block-label" for="been-here-before-no">
            <input id="been-here-before-no" type="radio" name="been-here-before" value="No">
            No
          </label>

        </fieldset>

        <input type="submit" class="button" value="Continue">
      </form>

      <form id="registration-form" method="POST" action="{% if data.action %}{{data.action}}{% else %}worldpay_1{% endif %}" id="login-form"  novalidate data-clientside-validation="login_form_validation">

        <p class="spacing-bottom-single">If you do not have an account you will need to <a href="create_account?title_number={{data.title_number}}" id="register-link">Register</a></p>

        {% if data.title_number %}
          <input name="title_number" value="{{data.title_number}}" type="hidden" />
        {% endif %}

        <!-- If this field is present in the GET or POST data sent to the server -->
        <!-- it will instantly log the user in. This is obviously not how "real" -->
        <!-- sign-ins work! It is a massive hack for prototyping only -->
        <input name="do_sign_in" value="true" type="hidden" />

        <!-- Email -->
        <div class="form-group">
          <label class="form-label-bold" for="email">Email address</label>
          <input type="email" class="form-control" name="email" id="email"{% if data.email %} value="{{data.email}}"{% endif %}{% if data.username %} value="{{data.username}}"{% endif %}>
        </div>

        <!-- Password -->
        <div class="form-group">
          <label class="form-label-bold" for="password">
            Password
          </label>
          <input type="password" class="form-control" id="password" name="password">
          <p class="spacing-top-half"><a href="{{path}}/reset/password/send_email?title_number={{data.title_number}}">Forgotten your password?</a></p>
        </div>

        <!-- T&Cs -->
        <div class="form-group" id="terms_group">
          <label class="block-label" for="terms">
            <input id="terms" name="terms" type="checkbox" value="terms">
            I have read and agree to the <a href="terms_and_conditions">terms &amp; conditions</a>
          </label>
        </div>

        <input type="submit" class="button" value="Sign in">

      </form>

      <script>
      (function() {
        var link = document.getElementById('register-link');
        var email = document.getElementById('email');

        link.addEventListener('click', function(e) {
          e.preventDefault();

          window.location = this.getAttribute('href') + '&email=' + email.value;
        });
      })();
      </script>

      <script>
      (function() {
        var regForm = document.getElementById('registration-form');
        regForm.classList.add('visuallyhidden');

        var beenHereBeforeForm = document.getElementById('been-here-before');
        beenHereBeforeForm.addEventListener('submit', function(e) {

          if(document.getElementById('been-here-before-yes').checked) {
            e.preventDefault();
            regForm.classList.remove('visuallyhidden');
            beenHereBeforeForm.classList.add('visuallyhidden');
          }

        });

      })();
      </script>

      <script type="application/json" id="login_form_validation">
        {
          "email": {
            "presence": {
              "message": "Email address is required"
            }
          },
          "password": {
            "presence": {
              "message": "Password is required"
            }
          },
          "terms": {
            "presence": {
              "message": "You must agree to our terms and conditions before continuing"
            }
          }
        }
      </script>

      <div class="panel panel-border-narrow spacing-bottom-single spacing-top-double">
        <p>If you have any problems signing in, you can <a href="https://www.gov.uk/government/organisations/land-registry/about/access-and-opening">contact Land Registry</a>.</p>
      </div>

      <p>You can also <a href="https://www.gov.uk/government/publications/official-copies-of-register-or-plan-registration-oc1">order information in paper format</a>.</p>

    </div>
  </div>

{% endblock %}
