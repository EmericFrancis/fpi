{% extends "./layout/layout.html" %}

{% block head_additionals %}

  <style type="text/css">
  .form-group {
    position: relative;
  }

  #circularG{
    position:relative;
    height:21px;
    margin: 5px auto;
    opacity: 0;
    transition: 0.3s opacity ease-in-out;
    display: block;
  }

  @media(min-width: 500px) {
    #circularG{
      position:absolute;
      margin-left: 30px;
      width:21px;
      left: 50%;
      width: 50%;
      top: 0;
      white-space: nowrap;
    }
  }

  #circularG:before {
    content: 'Checking if your email address already exists...';
    width: 100%;
    padding-left: 30px;
    left: 0;
  }

  #circularG.show {
    opacity: 1;
  }

  .circularG{
    position:absolute;
    background-color:rgb(0,0,0);
    width:5px;
    height:5px;
    border-radius:3px;
      -o-border-radius:3px;
      -ms-border-radius:3px;
      -webkit-border-radius:3px;
      -moz-border-radius:3px;
    animation-name:bounce_circularG;
      -o-animation-name:bounce_circularG;
      -ms-animation-name:bounce_circularG;
      -webkit-animation-name:bounce_circularG;
      -moz-animation-name:bounce_circularG;
    animation-duration:1.1s;
      -o-animation-duration:1.1s;
      -ms-animation-duration:1.1s;
      -webkit-animation-duration:1.1s;
      -moz-animation-duration:1.1s;
    animation-iteration-count:infinite;
      -o-animation-iteration-count:infinite;
      -ms-animation-iteration-count:infinite;
      -webkit-animation-iteration-count:infinite;
      -moz-animation-iteration-count:infinite;
    animation-direction:normal;
      -o-animation-direction:normal;
      -ms-animation-direction:normal;
      -webkit-animation-direction:normal;
      -moz-animation-direction:normal;
  }

  #circularG_1{
    left:0;
    top:8px;
    animation-delay:0.41s;
      -o-animation-delay:0.41s;
      -ms-animation-delay:0.41s;
      -webkit-animation-delay:0.41s;
      -moz-animation-delay:0.41s;
  }

  #circularG_2{
    left:2px;
    top:2px;
    animation-delay:0.55s;
      -o-animation-delay:0.55s;
      -ms-animation-delay:0.55s;
      -webkit-animation-delay:0.55s;
      -moz-animation-delay:0.55s;
  }

  #circularG_3{
    top:0;
    left:8px;
    animation-delay:0.69s;
      -o-animation-delay:0.69s;
      -ms-animation-delay:0.69s;
      -webkit-animation-delay:0.69s;
      -moz-animation-delay:0.69s;
  }

  #circularG_4{
    left:13px;
    top:2px;
    animation-delay:0.83s;
      -o-animation-delay:0.83s;
      -ms-animation-delay:0.83s;
      -webkit-animation-delay:0.83s;
      -moz-animation-delay:0.83s;
  }

  #circularG_5{
    left:15px;
    top:8px;
    animation-delay:0.97s;
      -o-animation-delay:0.97s;
      -ms-animation-delay:0.97s;
      -webkit-animation-delay:0.97s;
      -moz-animation-delay:0.97s;
  }

  #circularG_6{
    left:13px;
    bottom:2px;
    animation-delay:1.1s;
      -o-animation-delay:1.1s;
      -ms-animation-delay:1.1s;
      -webkit-animation-delay:1.1s;
      -moz-animation-delay:1.1s;
  }

  #circularG_7{
    left:8px;
    bottom:0;
    animation-delay:1.24s;
      -o-animation-delay:1.24s;
      -ms-animation-delay:1.24s;
      -webkit-animation-delay:1.24s;
      -moz-animation-delay:1.24s;
  }

  #circularG_8{
    left:2px;
    bottom:2px;
    animation-delay:1.38s;
      -o-animation-delay:1.38s;
      -ms-animation-delay:1.38s;
      -webkit-animation-delay:1.38s;
      -moz-animation-delay:1.38s;
  }



  @keyframes bounce_circularG{
    0%{
      transform:scale(1);
    }

    100%{
      transform:scale(.3);
    }
  }

  @-o-keyframes bounce_circularG{
    0%{
      -o-transform:scale(1);
    }

    100%{
      -o-transform:scale(.3);
    }
  }

  @-ms-keyframes bounce_circularG{
    0%{
      -ms-transform:scale(1);
    }

    100%{
      -ms-transform:scale(.3);
    }
  }

  @-webkit-keyframes bounce_circularG{
    0%{
      -webkit-transform:scale(1);
    }

    100%{
      -webkit-transform:scale(.3);
    }
  }

  @-moz-keyframes bounce_circularG{
    0%{
      -moz-transform:scale(1);
    }

    100%{
      -moz-transform:scale(.3);
    }
  }
  </style>

{% endblock %}

{% block title %}Register{% endblock %}

{% block body %}
  <h1 class="heading-large">Register</h1>

  <div class="grid-row">

    <div class="column-two-thirds tablet-column-two-thirds">

      <p class="lede">Due to the information this service reveals, we ask people to register with us.</p>

<!--
      Customer registration has been introduced so that our Find A Property service conforms to standard industry practice and is brought in line with other online service providers who ask users to register in order to gain access to information. This change also makes our service more secure.
-->

      <form class="spacing-top-double" action="account_created_continue" method="POST" novalidate data-clientside-validation="create_account_form_validation">
        <input name="title_number" value="{{data.title_number}}" type="hidden" />

        <!-- If this field is present in the GET or POST data sent to the server -->
        <!-- it will instantly log the user in. This is obviously not how "real" -->
        <!-- sign-ins work! It is a massive hack for prototyping only -->
        <input name="do_sign_in" value="true" type="hidden" />

        <fieldset>

          <legend class="visuallyhidden">Account details</legend>

            <div class="form-group">
              <label class="form-label" for="email">Email address
              <a href="#why-do-we-need-email" class="font-xsmall split-detail-trigger spacing-left-single">Our email usage policy</a></label>


              <input class="form-control" type="email" id="email" name="email" data-email-hint value="{{data.email}}">
              <div class="split-detail-contents font-xsmall" id="why-do-we-need-email">
                <div class="panel panel-border-narrow spacing-bottom-single">
                  <p>Your email address will be used to log into the service in future. If you forget your password we will use your email address to help you reset it.</p>
                  <p>We won't use your email address for any purposes other than access to this service.</p>
                  <p>We won't share your email with third parties.</p>
                </div>
              </div>
              <div id="circularG"><div id="circularG_1" class="circularG"></div><div id="circularG_2" class="circularG"></div><div id="circularG_3" class="circularG"></div><div id="circularG_4" class="circularG"></div><div id="circularG_5" class="circularG"></div><div id="circularG_6" class="circularG"></div><div id="circularG_7" class="circularG"></div><div id="circularG_8" class="circularG"></div></div>
            </div>

            <div style="clear:both" class="visuallyhidden warning media" id="email-in-use">
              <div class="media-item">
                <i class="icon icon-important">
                  <span class="visuallyhidden">Warning</span>
                </i>
              </div>

              <div class="media-body">
                <h2 class="heading-small spacing-bottom-flush">This email address is already in use</h2>
                <p class="spacing-top-flush">Would you like to <a href="sign_in?title_number={{data.title_number}}&amp;email=pat@gmail.com">sign in</a> or <a href="reset/password/email_sent?title_number={{data.title_number}}&amp;email=pat@gmail.com">create a new password</a>?</p>
              </div>
            </div>

            <div class="panel panel-border-narrow visuallyhidden email-hint">
              <p>Please ensure your email address is displayed correctly below. If you forget your password we will use your email address to help you reset it.</p>
              <p id="email-hint-value" class="bold"></p>
            </div>

          <div class="form-group disabled-if-email-exists">
            <label class="form-label" for="pass">Create a password</label>
            <input class="form-control" type="password" id="pass" name="pass" data-password-reveal>

            <p class="form-hint">Your password must:</p>
            <ul class="form-hint list list-bullet spacing-bottom-flush">
              <li>be between 8 and 20 characters</li>
              <li>contain 2 numbers</li>
              <li>not contain the symbols &pound; &#x20AC; &#x00AC; &#x00A6;</li>
            </ul>
          </div>

        </fieldset>

        <h2 class="heading-medium disabled-if-email-exists">Your details</h2>

        <fieldset class="disabled-if-email-exists">

          <legend class="visuallyhidden">Your details</legend>

          <div class="form-group">
            <label class="form-label" for="title">Title</label>
            <select style="width:auto;" class="form-control" id="title" name="title">
              <option value="">Please select</option>
              <option value="Mr">Mr</option>
              <option value="Mrs">Mrs</option>
              <option value="Miss">Miss</option>
              <option value="Ms">Ms</option>
              <option value="Other">Other</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label" for="firstname">First name</label>
            <input class="form-control" type="text" id="firstname" name="firstname">
          </div>

          <div class="form-group">
            <label class="form-label" for="lastname">Last name</label>
            <input class="form-control" type="text" id="lastname" name="lastname">
          </div>

          <div class="form-group">
          <label class="form-label" for="phone">Phone number (optional)
              <a href="#why-do-we-need-phone" class="font-xsmall split-detail-trigger spacing-left-single">Why we ask for phone number</a></label>


              <input style="width:auto;" size="20" class="form-control" type="phone" id="phone" name="phone" data-phone-hint>
              <div class="split-detail-contents font-xsmall" id="why-do-we-need-phone">
                <div class="panel panel-border-narrow spacing-bottom-single">
                  <p>We won't contact you by phone.</p>
                  <p>We won't share your phone number with third parties.</p>
                </div>
              </div>
          </div>

        </fieldset>

        <h2 class="heading-medium disabled-if-email-exists">Address</h2>

        <fieldset class="disabled-if-email-exists">

          <legend class="visuallyhidden">Address</legend>

          <div class="form-group">
            <label class="form-label" for="address">First line of your address</label>
            <input class="form-control" type="text" id="address" name="address">
          </div>

          <div class="form-group">
            <label class="form-label" for="city">Town or City</label>
            <input class="form-control" type="text" id="town" name="town">
          </div>

          <div class="form-group">
            <label class="form-label" for="country">Country</label>
            <select class="form-control" id="country" name="country">
              {% for country in countries %}
                <option value="{{country.entry.country}}" {% if country.entry.country == 'GB' %}selected{% endif %}>{{country.entry.name}}</option>
              {% endfor %}
            </select>
          </div>

          <div class="form-group">
            <label class="form-label" for="postcode">Postcode</label>
            <input size="12" style="width:auto;" class="form-control" type="text" id="postcode" name="postcode">
          </div>

        </fieldset>

        <div class="form-group spacing-top-double disabled-if-email-exists">
          <label class="block-label" for="terms">
            <input id="terms" name="terms" type="checkbox" value="terms">
            I have read and agree to the <a href="terms_and_conditions">terms &amp; conditions</a>
          </label>
        </div>

        <input type="submit" class="button spacing-top-single disabled-if-email-exists" value="Register">
      </form>

      <div class="panel panel-border-narrow spacing-top-double">
        <p>If you have any problems registering, you can <a href="https://www.gov.uk/government/organisations/land-registry/about/access-and-opening">contact Land Registry</a>.</p>
      </div>

      <script type="application/json" id="create_account_form_validation">
        {
          "email": {
            "email": true,
            "presence": {
              "message": "Email address is required"
            }
          },
          "pass": {
            "presence": {
              "message": "Password is required"
            },
            "length": {
              "minimum": 8,
              "maximum": 20,
              "message": "Password should be between 8 and 20 characters long. Characters can include letters, number and symbols."
            },
            "find_property_information_password": true
          },
          "title": {
            "presence": {
              "message": "Title is required"
            }
          },
          "firstname": {
            "presence": {
              "message": "First name is required"
            }
          },
          "lastname": {
            "presence": {
              "message": "Last name is required"
            }
          },
          "address": {
            "presence": {
              "message": "Address is required"
            }
          },
          "town": {
            "presence": {
              "message": "Town or City is required"
            }
          },
          "country": {
            "presence": {
              "message": "Country is required"
            }
          },
          "postcode": {
            "presence": {
              "message": "Postcode is required"
            }
          },
          "terms": {
            "presence": {
              "message": "You must agree to our terms and conditions before continuing"
            }
          }
        }
      </script>

      <script>
        (function() {
          var emailInput = document.getElementById('email');

          var fields = document.querySelectorAll('input[type="text"], input[type="password"], input[type="checkbox"], input[type="submit"], select');
          var disabledIfEmailExists = document.querySelectorAll('.disabled-if-email-exists');

          var emailDebounceTimeout;
          var emailCheckTimeout;
          var emailCheckSpinner = document.getElementById('circularG');

          var existingEmails = [
            'john@gmail.com',
            'jane@gmail.com',
            'pat@gmail.com'
          ];

          var signinMessage = document.getElementById('email-in-use');

          function change(e) {
            clearTimeout(emailCheckTimeout);
            clearTimeout(emailDebounceTimeout);

            emailCheckSpinner.classList.remove('show');
            emailDebounceTimeout = setTimeout(function() {
              emailCheckSpinner.classList.add('show');

              emailCheckTimeout = setTimeout(function() {
                emailCheckSpinner.classList.remove('show');

                if(existingEmails.indexOf(emailInput.value) === -1) {
                  signinMessage.classList.add('visuallyhidden');

                  [].forEach.call(fields, function(field) {
                    field.disabled = false;

                    [].forEach.call(disabledIfEmailExists, function(item) {
                      item.style.opacity = 1;
                    });
                  });

                } else {
                  signinMessage.classList.remove('visuallyhidden');

                  [].forEach.call(fields, function(field) {
                    field.disabled = true;

                    [].forEach.call(disabledIfEmailExists, function(item) {
                      item.style.opacity = 0.3;
                    });
                  });
                }

              }, 1500);
            }, 300);
          }

          emailInput.addEventListener('keyup', change);
          emailInput.addEventListener('change', change);
        })();
      </script>

    </div>
  </div>
{% endblock %}
